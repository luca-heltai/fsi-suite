<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fluid structure interaction suite: Introduction to the FSI-suite</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Fluid structure interaction suite
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('design.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Introduction to the FSI-suite </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This project collects a series of codes that I have written during the years for my own research.</p>
<p>I found myself writing the same code over and over again, and tried several approaches to unify everything under a single master application that would do everything I ever needed.</p>
<p>This never really worked out as expected. One of the most advanced tool that was developed in our group with this principle in mind was the pi-DoMUS library (<a href="https://github.com/mathLab/pi-DoMUS">https://github.com/mathLab/pi-DoMUS</a>). After a couple of years of intense development, that project was abandoned as it became more and more difficult to maintain. That project relied eavily on a tool kit library, which we named deal2lkit (<a href="https://github.com/mathLab/deal2lkit">https://github.com/mathLab/deal2lkit</a>) <a class="el" href="citelist.html#CITEREF_SartoriGiulianiBardelloni-2018-a">[3]</a></p>
<p>The deal2lkit library was a good starting point, but we quickly found out that the development of the deal.II library itself runs way faster than we could ever hope to keep up with, and we decided to slowly incorporate anything that could be savaged from deal2lkit into deal.II itself.</p>
<p>SymbolicFunction, <a class="elRef" href="http://www.dealii.org/developer/doxygen/deal.II/classFunctionParser.html">FunctionParser</a>, <a class="elRef" href="http://www.dealii.org/developer/doxygen/deal.II/classManifold.html">Manifold</a>, <a class="elRef" href="http://www.dealii.org/developer/doxygen/deal.II/classParameterAcceptor.html">ParameterAcceptor</a>, ParsedErrorTable, and the <a class="elRef" href="http://www.dealii.org/developer/doxygen/deal.II/classLinearOperator.html">LinearOperator</a> classes are some of the results of this effort, and are currently used widely by the deal.II community <a class="el" href="citelist.html#CITEREF_HeltaiBangerthKronbichler-2021">[1]</a>, <a class="el" href="citelist.html#CITEREF_MaierBardelloniHeltai-2016-a">[2]</a>.</p>
<p>The task is not finished yet. It is painful to port code from user space into a large library. The documentation requirements are stringent, proper testing is mandatory, and time always runs out.</p>
<p>When I started working on fluid structure interaction problems (2004), it was very difficult to find advanced codes that one could learn from. Deal.II itself only had 17 tutorial programs (<a class="elRef" href="http://www.dealii.org/developer/doxygen/deal.II/step_17.html">step-17</a> was the most advanced one). Today there are exceptional examples that show how to do everything, often in different ways, and the number of example programs is growing at a speed which is very difficult to keep up with.</p>
<p>This project is what I wish I had at my disposal when I started working on FSI using deal.II. I collect here all the codes that I have written that relate in one way or another to fluid structure interaction problems.</p>
<p>Documentation is still largely missing. But I have tried to keep up with the main classes and functions. Since I have given up trying to build a "one-fits-all" code, this project goes in the opposite direction. I collected every common bit of code that I found mymeslf rewriting over and over again in the <a class="el" href="namespace_parsed_tools.html" title="We collect in this namespace some wrappers around commonly used deal.II classes, derived from the Par...">ParsedTools</a> namespace, and rewrote some of the basic tutorials of deal.II that have to do with FSI using the <a class="el" href="namespace_parsed_tools.html" title="We collect in this namespace some wrappers around commonly used deal.II classes, derived from the Par...">ParsedTools</a> namespace. This allows you to use the same base code for many different problems, and to keep the code as similar as possible, even when they solve very different problems. All repetitive tasks (like the creation of a mesh, the creation of a finite element space, the creation of a linear solver, writing output to files, etc.) are handled via objects that understand how to parse options from parameter files (i.e., they are derived from the <a class="elRef" href="http://www.dealii.org/developer/doxygen/deal.II/classParameterAcceptor.html">ParameterAcceptor</a> class)</p>
<p>Individual programs are as small as possible, and as clean as possible. Each code solves a single problem. A lot of duplication is unavoidable, but this has the advantage that it is easy to make incremental steps, and understand the most difficult parts of the FSI suite by walking through examples that increase in complexity, pretty much like it is done in the deal.II tutorial programs.</p>
<p>The structure of the FSI suite programs follows very closely deal.II tutorial programs. In each program, I try to point the reader to the steps that are required to understand what is going on.</p>
<h1><a class="anchor" id="installation"></a>
Installation</h1>
<p>This project is hosted on GitHub. You can clone the repository using the command <code>git clone <a href="https://github.com/luca-heltai/fsi-suite.git">https://github.com/luca-heltai/fsi-suite.git</a></code>. This will generate a local copy of the repository in the directory <code>fsi-suite</code>. In order for you to run the code, you need to have the deal.II library installed and available in your default include path (i.e., <code>/usr/local/</code> or <code>/usr/</code>), or you should define the variable DEAL_II_DIR that points to your deal.II installation path.</p>
<p>The deal.II library should be installed with the following options:</p>
<ul>
<li><code>DEAL_II_HAVE_CXX17=ON</code></li>
<li><code>DEAL_II_WITH_CGAL=ON</code></li>
<li><code>DEAL_II_WITH_MPI=ON</code></li>
<li><code>DEAL_II_WITH_MU_PARSER=ON</code></li>
<li><code>DEAL_II_WITH_OPENCASCADE=ON</code></li>
<li><code>DEAL_II_WITH_PETSC=ON</code></li>
<li><code>DEAL_II_WITH_TRILINOS=ON</code></li>
<li><code>DEAL_II_WITH_SUNDIALS=ON</code></li>
<li><code>DEAL_II_WITH_SYMENGINE=ON</code></li>
<li><code>DEAL_II_WITH_UMFPACK=ON</code></li>
</ul>
<p>Once you have downloaded the code, you can configure and compile it using the following:</p>
<div class="fragment"><div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Release ..</div>
<div class="line">make -j4</div>
<div class="line">./gtest</div>
</div><!-- fragment --><p>The above will create a build directory, run cmake, compile the code, and run a test suite that checks that everything works fine. If everything succeeds, you should have a directory with a few executables in it (i.e., gtest, mesh_handler, dof_plotter, poisson, etc.).</p>
<p>I provide a docker image that can be used to build and run the code within a container. The image can be downloaded by <code>docker pull heltai/dealii:vscode</code>. This is also provided in the <code>.devcontainer</code> directory. If you open the folder using VisualStudio code, and have the Remote-Container extension installed, then you can build and run the code within a container that contains a full deal.II installation, simply by re-opening the folder in the container, and you should be good to go.</p>
<p>Notice that the container uses gcc, and this is quite memory intensive. If you don't have at least 16GB of RAM, you may encounter problems. In case compilation fails, you can try recompiling using fewer processors.</p>
<h1><a class="anchor" id="general_structure"></a>
General structure of the FSI-suite</h1>
<p>The main source directories of the FSI-suite are:</p>
<ul>
<li><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a>, containing the declaration for each of the classes and functions of the FSI-suite</li>
<li><a class="el" href="dir_b2f33c71d4aa5e7af42a1ca61ff5af1b.html">source</a>, containing the implementations and instantiations of most objects</li>
<li>tests, containing all the tests that are run on the FSI-suite with continuous integration based on github (see <a href="https://github.com/luca-heltai/fsi-suite/actions">https://github.com/luca-heltai/fsi-suite/actions</a>)</li>
<li><a class="el" href="dir_9654b8d08f4bba4e84b362c5fd320bee.html">apps</a>, containing the main files, used to generate the actual applications. If you want to create your own application, you can just copy it here in this folder, and cmake will compile it to an application with the same name of the source file (without extension).</li>
</ul>
<p>Other directories are accessible on the main repository page, and contain links to the video lectures, slides of each lecture, lecture notes, grids, and the input parameters used in the examples.</p>
<h1><a class="anchor" id="program_structure"></a>
Structure of programs in the FSI-suite</h1>
<p>The FSI-suite programs are organized in a hierarchy of <a class="el" href="namespace_p_d_es.html" title="We collect in this namespace all PDEs that are relevant to Fluid Structure Interaction Problems.">PDEs</a>, with increasing difficulty both at the mathematical/physical/modelling level, and at the programming level.</p>
<p>Each program is split in three parts: a header file, containing the main class declaration (in the directory <a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a>), a source file (in the directory <a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a>) containing the implementation of the main class, and a main application file (in the directory <a class="el" href="dir_9654b8d08f4bba4e84b362c5fd320bee.html">apps</a>), containing only the main function.</p>
<p>Each class is derived from <a class="elRef" href="http://www.dealii.org/developer/doxygen/deal.II/classParameterAcceptor.html">ParameterAcceptor</a>, and has a public constructor that takes no arguments (or only arguments for which a default is specified). The user entry point for each class is the method <code><a class="el" href="namespace_runner.html#aaed149dffa73f0cdbfccc2ea84373909" title="Setup parameters from the command line, and call the Class::run() method.">run()</a></code>.</p>
<p>The main functions in the <a class="el" href="dir_9654b8d08f4bba4e84b362c5fd320bee.html">apps</a> folder take care of parsing the command line, deducing from the command line (or from parameter file itself) in what dimension and space dimension you want to run the code, and then they instantiate the specific class for the specific dimension and spacedimension combination, read parameters from the parameter file, and execute the <code><a class="el" href="namespace_runner.html#aaed149dffa73f0cdbfccc2ea84373909" title="Setup parameters from the command line, and call the Class::run() method.">run()</a></code> method of the class.</p>
<p>The interface to all programs is uniform. Running any of the programs with an <code>-h</code> or <code>--help</code> argument will return something like the following: </p><div class="fragment"><div class="line">./your_code_here --help</div>
<div class="line">Usage: ./your_code_here [OPTIONS] [PRM FILE]</div>
<div class="line">Options:</div>
<div class="line">-h, --help                        Print this help message</div>
<div class="line">-i, --input_prm_file &lt;filename&gt;   Input parameter file. Defaults to the</div>
<div class="line">                                  empty string (meaning: use the default</div>
<div class="line">                                  values, or the values specified on the</div>
<div class="line">                                  command line). Notice that you can</div>
<div class="line">                                  specify the input paramter file also as</div>
<div class="line">                                  the first positional arguement to the</div>
<div class="line">                                  program.</div>
<div class="line">-o, --output_prm_file &lt;filename&gt;  Where to write the file containing the</div>
<div class="line">                                  actual parameters used in this run of</div>
<div class="line">                                  the program. It defaults to the string</div>
<div class="line">                                  `used_program_name.prm&#39; if the input</div>
<div class="line">                                  parameter file is not specified,</div>
<div class="line">                                  otherwise it defaults to the string</div>
<div class="line">                                  `used_&#39; followed by the name of the</div>
<div class="line">                                  input parameter file.</div>
<div class="line">-d, --dim &lt;value&gt;                 Dimension at which this program should</div>
<div class="line">                                  be run. Defaults to 2.</div>
<div class="line">-s, --spacedim &lt;value&gt;            Space dimension at which this program</div>
<div class="line">                                  should run. Defaults to 2.</div>
<div class="line">-&quot;Section/option name&quot;=&lt;value&gt;    Any of the options that you can specify</div>
<div class="line">                                  in the parameter file. The format here</div>
<div class="line">                                  is the following: -&quot;Section/Subsection/</div>
<div class="line">                                  option&quot;=&quot;value,another value&quot;, where the</div>
<div class="line">                                  quotes are required only if an otpion</div>
<div class="line">                                  contains spaces, or if a value contains</div>
<div class="line">                                  separators, like commas, columns, etc.</div>
</div><!-- fragment --><p> followed by a (possibly very long) list of parameters that you can change from the command line, or from within a parameter file. The shorstest example is the <a class="el" href="class_mesh_handler.html" title="Entry point of the FSI-suite programs.">MeshHandler</a> class, for which the output of the <code>-h</code> would print in addition to the above message, also the following: </p><div class="fragment"><div class="line">...</div>
<div class="line">Listing of Parameters:</div>
<div class="line"> </div>
<div class="line">set Arguments                  = Any string</div>
<div class="line">set Initial grid refinement    = An integer</div>
<div class="line">set Input name                 = Any string</div>
<div class="line">set Output name                = Any string</div>
<div class="line">set Transform to simplex grid  = A boolean value (true or false)</div>
<div class="line">set Verbosity                  = An integer n such that -1 &lt;= n &lt;= 2147483647</div>
</div><!-- fragment --><h1><a class="anchor" id="running"></a>
Running a program of the FSI-suite</h1>
<p>Every program in the FSI-suite can be executed by calling it with arguments specifying the dimension and space dimension, or it can read these numbers from your parameter file. For example: </p><div class="fragment"><div class="line">./poisson -d=2 -s=3 -i=input.prm -o=output.prm</div>
</div><!-- fragment --><p> will run the poisson problem in dimension 2 with spacedimension 3, reading options from the <code>input.prm</code> file in the current directory, and writing all used options in the <code>output.prm</code> file in the current directory.</p>
<p>The same effect can be obtained by inserting in your parameter file the combination of dimension and spacedimension, i.e.,</p>
<div class="fragment"><div class="line"># Listing of Parameters</div>
<div class="line"># ---------------------</div>
<div class="line">set dim      = 1</div>
<div class="line">set spacedim = 2</div>
</div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>If you specify the dimension (and/or the spacdimension) from the command line, and provide a parameter file as input that contains a different combination, you will get an error message. Either do not put the combination in your parameter file, or make sure that they are consistent with the command line options</dd></dl>
<p>Notice that <code>input.prm</code> does not need to exist prior to executing the program. If it does not exist, the program will create it for you, print an error message, and exit.</p>
<p>The file <code>input.prm</code> may be empty, or may specify just the parameters that you want to change from their default value. If you specify a parameter in the command line, it will override the value specified in the parameter file.</p>
<p>The output file <code>output.prm</code> will contain all the parameters that were used during the execution of the program, so that you can reproduce the results of the last simulation by simply re-running the program with the file that was just generated.</p>
<p>Any parameter that you can change from the parameter files, can be changed also from the command line. The opposite is also true, with the exception of the input and output parameter files (<code>-i</code> and <code>-o</code>), which do not have, in general, a correspondending entry in the parameter file itself.</p>
<p>For parameters with spaces in their names and sections, you can surround the option and/or the value by quotes. For example, to change the parameter corresponding to the initial time of a simulation, in a parameter file that looks like this: </p><div class="fragment"><div class="line">subsection General parameters</div>
<div class="line">  set Initial time = 0.0</div>
<div class="line">end</div>
</div><!-- fragment --><p> you can either change the value of the parameter in the parameter file, or use the following syntax on the command line: </p><div class="fragment"><div class="line">./program -&quot;General parameters/Initial time&quot;=1.0</div>
</div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>The command line parser ignores the number of dashes you use. So <code>-d</code> is the same as <code>--d</code> and the same of <code>-------d</code>.</dd></dl>
<h1><a class="anchor" id="start_here"></a>
Where to start?</h1>
<p>The applications <a class="el" href="class_mesh_handler.html" title="Entry point of the FSI-suite programs.">MeshHandler</a> and <a class="el" href="dof__plotter_8cc.html" title="Degrees of freedom plotter.">dof_plotter.cc</a> are the equivalent of <a class="elRef" href="http://www.dealii.org/developer/doxygen/deal.II/step_1.html">step-1</a> and <a class="elRef" href="http://www.dealii.org/developer/doxygen/deal.II/step_2.html">step-2</a> of the deal.II library. They show how to create a mesh and how to plot degrees of freedom on a grid. They allow you to get familiar with the building blocks defined in the <a class="el" href="namespace_parsed_tools.html" title="We collect in this namespace some wrappers around commonly used deal.II classes, derived from the Par...">ParsedTools</a> namespace. <a class="el" href="class_mesh_handler.html" title="Entry point of the FSI-suite programs.">MeshHandler</a> shows how to use the <a class="el" href="class_parsed_tools_1_1_grid_generator.html" title="GridGenerator class.">ParsedTools::GridGenerator</a> class to create a mesh, or read it from a file, and how to write it out again (possibly in a different format). This is useful, for example, if you want to visualise the mesh using Paraview or <a class="elRef" href="http://www.dealii.org/developer/doxygen/deal.II/namespaceGmsh.html">Gmsh</a>.</p>
<p><a class="el" href="dof__plotter_8cc.html" title="Degrees of freedom plotter.">dof_plotter.cc</a> shows how to use the <a class="el" href="class_parsed_tools_1_1_finite_element.html" title="Parsed FiniteElement.">ParsedTools::FiniteElement</a> class, and how to use it in conjunction with the <a class="el" href="class_parsed_tools_1_1_data_out.html">ParsedTools::DataOut</a> class to generate <a class="elRef" href="http://www.dealii.org/developer/doxygen/deal.II/classFiniteElement.html">FiniteElement</a> objects from a parameter file, and to output simple functions to a graphical output file supported by deal.II (i.e., the de-facto standard output format <code>.vtu</code> or <code>.vtk</code>).</p>
<p>The entry point for partial differential equations treated in the FSI-suite is the <a class="el" href="class_p_d_es_1_1_serial_1_1_poisson.html" title="Poisson problem, serial version.">PDEs::Serial::Poisson</a> problem. This problem gathers together <a class="elRef" href="http://www.dealii.org/developer/doxygen/deal.II/step_3.html">step-3</a>, <a class="elRef" href="http://www.dealii.org/developer/doxygen/deal.II/step_4.html">step-4</a>, <a class="elRef" href="http://www.dealii.org/developer/doxygen/deal.II/step_5.html">step-5</a>, and <a class="elRef" href="http://www.dealii.org/developer/doxygen/deal.II/step_6.html">step-6</a> of the deal.II Library, and allows you to solve a <a class="el" href="class_p_d_es_1_1_serial_1_1_poisson.html" title="Poisson problem, serial version.">PDEs::Serial::Poisson</a> equation in an arbitrary domain, using all available <a class="elRef" href="http://www.dealii.org/developer/doxygen/deal.II/classFiniteElement.html">FiniteElement</a> classes of the deal.II library, including Simplex elements. The FSI-suite is, at the moment, only supporting pure grids: either all-hex or all-tets meshes are supported.</p>
<p>If you want to navigate through the available partial differential equations that are solved by the FSI-suite, you should take a look at the <a class="el" href="namespace_p_d_es.html" title="We collect in this namespace all PDEs that are relevant to Fluid Structure Interaction Problems.">PDEs</a> namespace, where you will find a list of the available <a class="el" href="namespace_p_d_es.html" title="We collect in this namespace all PDEs that are relevant to Fluid Structure Interaction Problems.">PDEs</a>, with their connections. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Jun 25 2024 07:58:03 for Fluid structure interaction suite by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
